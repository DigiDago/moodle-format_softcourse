/**
 * Various actions on sections like update image, delete image, ...
 *
 * @module     format_softcourse/actions
 * @copyright  2019 Pimenko <contact@pimenko.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("format_softcourse/actions",["jquery","core/ajax","theme_boost/bootstrap/tooltip"],(function($,ajax){return{init:function(){M.course=M.course||{},M.course.format=M.course.format||{},M.course.format.get_config=function(){return{container_node:"ul",container_class:"softcourse",section_node:"li",section_class:"section"}},M.course.format.swap_sections=function(Y,node1,node2){let CSS_COURSECONTENT="course-content",CSS_SECTIONADDMENUS="section_add_menus",sectionlist=Y.Node.all("."+CSS_COURSECONTENT+" "+M.course.format.get_section_selector(Y));sectionlist.item(node1).one("."+CSS_SECTIONADDMENUS).swap(sectionlist.item(node2).one("."+CSS_SECTIONADDMENUS))},M.course.format.process_sections=function(Y,sectionlist,response,sectionfrom,sectionto){let CSS_SECTIONNAME="sectionname",SELECTORS_SECTIONLEFTSIDE=".left .section-handle .icon";if("move"===response.action){if(sectionfrom>sectionto){let temp=sectionto;sectionto=sectionfrom,sectionfrom=temp}let ele,str,stridx,newstr;for(let i=sectionfrom;i<=sectionto;i++){let content=Y.Node.create("<span>"+response.sectiontitles[i]+"</span>");sectionlist.item(i).all("."+CSS_SECTIONNAME).setHTML(content),ele=sectionlist.item(i).one(SELECTORS_SECTIONLEFTSIDE),str=ele.getAttribute("alt"),stridx=str.lastIndexOf(" "),newstr=str.substr(0,stridx+1)+i,ele.setAttribute("alt",newstr),ele.setAttribute("title",newstr)}}},$(".section-file").on("change",(function(event){let sectionid=event.target.dataset.sectionid,courseid=event.target.dataset.courseid;if(courseid){let file=event.target.files[0],filedata=null;if(!file.type.match("image.*"))return;let that=this,reader=new FileReader;reader.onload=function(file){return function(e){filedata=e.target.result,$(that).parent().parent().css("background-image","url("+filedata+")"),$(that).parent().parent().addClass("not-empty");let imagedata=filedata.split("base64,")[1],filename=file.name;ajax.call([{methodname:"format_softcourse_update_section_image",args:{courseid:courseid,sectionid:sectionid,imagedata:imagedata,filename:filename},fail:function(response){window.console.error(response)}}],!0,!0)}}(file),reader.readAsDataURL(file)}})),$(".section-delete-file").on("click",(function(event){event.preventDefault(),event.stopPropagation();let sectionid=event.target.dataset.sectionid,courseid=event.target.dataset.courseid;$(this).parent().parent().css("background-image","none"),$(this).parent().parent().removeClass("not-empty"),ajax.call([{methodname:"format_softcourse_delete_section_image",args:{courseid:courseid,sectionid:sectionid},fail:function(response){window.console.error(response)}}],!0,!0)})),$('[data-toggle="tooltip"]').tooltip()}}}));

//# sourceMappingURL=actions.min.js.map